{"componentChunkName":"component---src-templates-blog-template-js","path":"/react-rendering-optimization/","result":{"data":{"cur":{"id":"c456e1a0-6b34-5e13-9a9e-9dde2bb5400f","html":"<p>무한 렌더링하는 컴포넌트를 정말 필요한 때에만 리렌더링하도록 최적화해봤습니다.</p>\n<ol>\n<li>무한 렌더링을 탈출한 후,</li>\n<li><code class=\"language-text\">useCallback</code>과 <code class=\"language-text\">React.memo</code>를 이용해 리렌더링을 최적화합니다.</li>\n</ol>\n<h2 id=\"무한-렌더링-탈출하기\" style=\"position:relative;\"><a href=\"#%EB%AC%B4%ED%95%9C-%EB%A0%8C%EB%8D%94%EB%A7%81-%ED%83%88%EC%B6%9C%ED%95%98%EA%B8%B0\" aria-label=\"무한 렌더링 탈출하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무한 렌더링 탈출하기</h2>\n<p>프로젝트는 간단한 투두리스트 앱으로 이렇게 생겼습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlElEQVQ4y52TzW7aQBRG/f6v0F33XfQBuui2baQADZikSvAftoES7PHYc2cGTmVDIlpB1WZxpG905x59s5igEyErSp7ihFprrPcYazHOXaafv+T+nnUorRBrEGsJpK4oZiHRaEyTJLjVCikLbFleJk2xeT4gZYlflzyOfhBPY7w1BFKucEmGWxb4ZcH+b+Ql++9T9l+/DbibW9jkfPwQ8f7dDPZt33CFZLfIcjxgr5FPzphil3fYbIzLJ6hohIonWKMJbJvSbEOe1yFWR2AzDpKecTz7LsF3Gb76gt9+wj9/xtc3eJMNe1bNEFMRWJ2it3Oq9T1qc0+9nlNvTvlEn61a4HSCU4+43QhXjXHqAadjTB1hdn8IXyWDcH5FGB+lOjvR5whREVKdhDIIw2F4MBmHLr2I1wlexxcRFZ8Jm4Ru94BtomOD5gr6OrY5E/ZPbjazobZvX1ok/8ixoal/axjTbkOkfsLrCNcs/htTL5DdHdLtCKQtaH+OkSrEqfmbGNr1QqMI+v8oVhAxmDfS7/aO3vULUxzaGdq/DLEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"투두리스트 앱 화면 구조\"\n        title=\"투두리스트 앱 화면 구조\"\n        src=\"/static/4acad27e6dac26b32aec58a3d63e1e59/37523/todolist-structure.png\"\n        srcset=\"/static/4acad27e6dac26b32aec58a3d63e1e59/e9ff0/todolist-structure.png 180w,\n/static/4acad27e6dac26b32aec58a3d63e1e59/f21e7/todolist-structure.png 360w,\n/static/4acad27e6dac26b32aec58a3d63e1e59/37523/todolist-structure.png 720w,\n/static/4acad27e6dac26b32aec58a3d63e1e59/302a4/todolist-structure.png 1080w,\n/static/4acad27e6dac26b32aec58a3d63e1e59/d073d/todolist-structure.png 1297w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>백엔드 서버에 API 요청을 해서 투두리스트 관련 데이터를 다루고 있습니다.</p>\n<p>TodoList 컴포넌트에서 투두 리스트 데이터를 받아와 화면에 보여줘야 하는데 그러면 API 요청이 필수적입니다.<br>\n투두 리스트를 가장 최신 상태로 유지하는 것이 가장 좋지만 그러면 API 요청이 잦아지고 컴포넌트의 리렌더링도 잦아질수 있어 성능이 크게 떨어집니다.<br>\n따라서 API 요청 자체를 최적화해야 합니다.</p>\n<p>최적화 전의 TodoList 컴포넌트는 이런 식으로 데이터를 받아오고 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">TodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>todoList<span class=\"token punctuation\">,</span> setTodoList<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Todo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchTodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setTodoList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">getTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">fetchTodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 후략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>네, 맞습니다. 무한으로 데이터를 받아오는 최악의 상태입니다.<br>\n<code class=\"language-text\">useEffect</code> 함수 안에서 <code class=\"language-text\">setTodoList</code> 함수를 통해 상태를 변화시키므로 TodoList 컴포넌트는 다시 렌더링되고 그러면 <code class=\"language-text\">useEffect</code> 함수가 또 다시 실행되어 무한으로 즐기게 됩니다.</p>\n<p>이 무한 렌더링 상태에서 벗어나기 위해 두 가지 방법을 생각했습니다.</p>\n<ol>\n<li>\n<p>투두리스트 데이터를 받아올 타이밍을 다루는 상태를 만들어서 관리하기<br>\n투두리스트 리렌더링 관련 상태를 만들어서 사용자가 투두를 생성했을 때, 수정했을 때, 삭제했을 때 등 특정 이벤트가 발생했을 때만 투두 리스트 데이터를 요청해서 리렌더링합니다.</p>\n</li>\n<li>\n<p>투두리스트 데이터를 상태로 관리하며 API 요청을 줄이기<br>\n투두리스트가 처음 렌더링되었을 때 최초 한번만 데이터를 fetch하여 받아옵니다. 해당 데이터를 state로 관리하며 사용자가 투두를 생성했을 때, 수정했을 때, 삭제했을 때 등 특정 이벤트가 발생했을 때 서버에 투두 리스트 데이터를 요청하여 데이터를 받아오는 대신 관리하던 투두리스트 상태를 기반으로 리렌더링합니다.</p>\n</li>\n</ol>\n<p>두 방법 모두 특정 이벤트에만 컴포넌트가 리렌더링되는 것은 같습니다만, 2번 방법이 투두 리스트 데이터를 받아오기 위한 API 요청이 줄어든다는 장점이 있습니다.<br>\n하지만 동시에 데이터 일관성을 보장할 수 없다는 것을 의미합니다.<br>\n투두리스트 앱 특성상 여러명이 사용할 일은 없지만 데이터 일관성을 유지하는 것이 추후 개발에 혼란을 야기하지 않을 것 같아 1번 방법을 선택했습니다.</p>\n<p>TodoList를 리렌더링하는 타이밍을 알려줄 상태를 하나 만들고, 그 상태를 변화시킬 수 있는 함수를 TodoInput 컴포넌트와 Todo 컴포넌트에 전달합니다.<br>\n투두리스트 리렌더링을 관리하는 컴포넌트를 새로 하나 만들고 TodoRerender라고 이름지었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">TodoRerender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>rerenderFlag<span class=\"token punctuation\">,</span> setRerenderFlag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">seState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rerender</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRerenderFlag</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>rerenderFlag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TodoInput</span></span> <span class=\"token attr-name\">rerender</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>rerender<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TodoList</span></span> <span class=\"token attr-name\">rerenderFlag</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>rerenderFlag<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">rerender</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>rerender<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러면 TodoInput 컴포넌트를 통해 투두를 생성할 때, Todo 컴포넌트를 통해 투두를 수정할 때와 삭제할 때 상태를 변화시켜 TodoList 리렌더링을 통제할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">TodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\trerenderFlag<span class=\"token punctuation\">,</span>\n\trerender<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> TodoListComponent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>todoList<span class=\"token punctuation\">,</span> setTodoList<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Todo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchTodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">setTodoList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">getTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">fetchTodoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>rerenderFlag<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>w-full mt-10 space-y-6<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>todoList\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>todo <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span></span>\n\t\t\t\t\t\t<span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>todo<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span>\n\t\t\t\t\t\t<span class=\"token attr-name\">todo</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>todo<span class=\"token punctuation\">}</span></span>\n\t\t\t\t\t\t<span class=\"token attr-name\">rerenderTodoList</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>rerender<span class=\"token punctuation\">}</span></span>\n\t\t\t\t\t<span class=\"token punctuation\">/></span></span>\n\t\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t);\n};</span></code></pre></div>\n<p>이렇게 수정한 투두리스트 앱을 테스트해보면 무한 렌더링은 벗어났지만 문제가 하나 있습니다.<br>\nTodoList 컴포넌트를 리렌더링할 때마다 상관없는 TodoInput 컴포넌트까지 같이 리렌더링됩니다.</p>\n<h2 id=\"usecallback과-reactmemo를-이용해-리렌더링-최적화하기\" style=\"position:relative;\"><a href=\"#usecallback%EA%B3%BC-reactmemo%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%A6%AC%EB%A0%8C%EB%8D%94%EB%A7%81-%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"usecallback과 reactmemo를 이용해 리렌더링 최적화하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useCallback과 React.memo를 이용해 리렌더링 최적화하기</h2>\n<p><img src=\"/a2fbbf41e6eb82f819448d1059ab0876/rendering-test.gif\" alt=\"투두리스트 앱 리렌더링 화면\"></p>\n<p>이런 불필요한 리렌더링이 발생하는 이유는 다음과 같습니다.</p>\n<p>기본적으로 컴포넌트는 state가 변했을 때 리렌더링됩니다.<br>\n그리고 상위 컴포넌트가 리렌더링된다면 그에 따라 하위 컴포넌트도 리렌더링됩니다.</p>\n<p>따라서, TodoList 컴포넌트에서 TodoRerender의 상태를 변경시켰으므로 하위 컴포넌트인 TodoInput 컴포넌트와 TodoList 컴포넌트 모두 리렌더링되는 것입니다.</p>\n<p>실제로는 TodoInput 컴포넌트가 변하지 않는데 불필요하게 리렌더링되는 것이므로 이러한 리렌더링을 방지할 것입니다.</p>\n<ol>\n<li>TodoInput 컴포넌트의 props가 변하지 않았다면 TodoInput 컴포넌트를 리렌더링하지 않도록 방지하기</li>\n<li>TodoRerender 컴포넌트에서 TodoInput 컴포넌트로 넘겨주는 rerender 함수가 다른 값으로 인식되지 않도록 만들기</li>\n</ol>\n<p>1번 방법을 위해서는 <code class=\"language-text\">React.memo</code>를, 2번 방법을 위해서는 <code class=\"language-text\">useCallback</code>을 사용할 것입니다.</p>\n<blockquote>\n<p>💡 <strong>React.memo</strong><br>\n컴포넌트의 props가 변하지 않았다면 해당 컴포넌트의 리렌더링을 방지하는 Built-in React API</p>\n</blockquote>\n<blockquote>\n<p>💡 <strong>useCallback</strong><br>\n함수를 재사용할 수 있는 React hook<br>\n이 hook을 사용하면 컴포넌트가 리렌더링되더라도 해당 함수의 내용이 변하지 않았다면 함수를 새로 만들지 않는다.<br>\n(원래는 컴포넌트가 리렌더링되면 그 컴포넌트 안의 함수도 전부 새로 만들어진다.)<br>\n하지만 함수 내용이 실제로 변했을 때는 함수가 새로 만들어져야 하기 때문에 <code class=\"language-text\">[]</code>로 dependencies를 명시해서 해당 디펜던시 배열 안의 값 중 변한 게 있다면 함수가 새로 만들어지도록 해줘야 한다.</p>\n</blockquote>\n<p>먼저 TodoInput 컴포넌트를 <code class=\"language-text\">React.memo</code> 함수로 감싸 props인 rerender 함수가 변하지 않았다면 리렌더링되지 않도록 만듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">TodoInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rerender <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> TodoInputComponent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 중략</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>TodoInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 TodoRerender 컴포넌트의 render 함수가 재사용될 수 있도록 useCallback 함수를 이용합니다.<br>\n추가적으로 상태를 업데이트할 때 상태를 직접 이용하지 않고 이전 상태를 이용하도록 구현하여 디펜던시를 줄였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">TodoRerender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>rerenderFlag<span class=\"token punctuation\">,</span> setRerenderFlag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rerender <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRerenderFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>prevRerenderFlag<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>prevRerenderFlag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 후략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 투두리스트 데이터를 렌더링할 때 TodoList 컴포넌트만 리렌더링되고 TodoInput 컴포넌트는 그대로 둘 수 있습니다.</p>\n<blockquote>\n<p>⚠️ <strong>React DevTools를 이용할 때의 주의점</strong><br>\nReact DevTools를 통해 컴포넌트 렌더링을 측정할 때 위에 서술된 방법으로 최적화를 진행해도 TodoInput 컴포넌트가 리렌더링되는 것처럼 보여줍니다.\n하지만 직접 console을 찍어보면 TodoInput 컴포넌트가 렌더링 최적화된 것을 알 수 있습니다.\n왜 이렇게 동작하는 지는 알 수 없지만 도구에만 의존하지 않고 의문이 되는 부분은 따로 체크하는 습관을 들이는 것이 좋을 것 같습니다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%AC%B4%ED%95%9C-%EB%A0%8C%EB%8D%94%EB%A7%81-%ED%83%88%EC%B6%9C%ED%95%98%EA%B8%B0\">무한 렌더링 탈출하기</a></li>\n<li><a href=\"#usecallback%EA%B3%BC-reactmemo%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%A6%AC%EB%A0%8C%EB%8D%94%EB%A7%81-%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EA%B8%B0\">useCallback과 React.memo를 이용해 리렌더링 최적화하기</a></li>\n</ul>\n</div>","excerpt":"무한 렌더링하는 컴포넌트를 정말 필요한 때에만 리렌더링하도록 최적화해봤습니다. 무한 렌더링을 탈출한 후, 과 를 이용해 리렌더링을 최적화합니다. 무한 렌더링 탈출하기 프로젝트는 간단한 투두리스트 앱으로 이렇게 생겼습니다.  백엔드 서버에 API 요청을 해서 투두리스트 관련 데이터를 다루고 있습니다. TodoList 컴포넌트에서 투두 리스트 데이터를 받아와 화면에 보여줘야 하는데 그러면 API 요청이 필수적입니다. 투두 리스트를 가장 최신 상태로 유지하는 것이 가장 좋지만 그러면 API 요청이 잦아지고 컴포넌트의 리렌더링도 잦아질수 있어 성능이 크게 떨어집니다. 따라서 API 요청 자체를 최적화해야 합니다. 최적화 전의 TodoList 컴포넌트는 이런 식으로 데이터를 받아오고 있습니다. 네, 맞습니다. 무한으로 데이터를 받아오는 최악의 상태입니다.  함수 안에서  함수를 통해 상태를 변화시키므로 TodoList 컴포넌트는 다시 렌더링되고 그러면  함수가 또 다시 실행되어 무한으로 즐…","frontmatter":{"date":"May 24, 2023","title":"리액트 렌더링 최적화하기","categories":"react"},"fields":{"slug":"/react-rendering-optimization/"}},"next":{"id":"d8ab4a06-efe8-5de2-b792-950753187384","html":"<p>올해 서버가 필요한 일이 많아 마구잡이로 AWS 프리티어 계정을 생성하면서 나에게도 몇천만원이 결제되는 일이 생길까봐 걱정이 되기 시작했다..<br>\n<em>“설마 그럴일이 있겠어~”</em> 싶었지만 그게 바로 사망플래그라고 주변에서 경고해서 최소한의 보안을 위해 앞으로는 MFA, IAM을 설정해주려 한다.</p>\n<p>MFA, IAM을 설정하는 방법을 설명하기에 앞서 MFA와 IAM은 당최 무엇인가?<br>\n간단하게 말하자면 MFA(Multi-Facfor Authentication)는 로그인할 때 더 까다롭게 인증하는 것이고, IAM(Identity and Access Management)은 AWS의 모든 기능에 접근할 수 있는 루트 사용자 대신 특정 기능만 사용할 수 있도록 사용자를 생성하는 것이다.<br>\n따라서 루트 사용자 계정에는 MFA를 적용해 접근하기 어렵게 만들고, 대신 IAM으로 권한을 줄인 사용자 계정을 만들어 사용하면 해당 사용자 계정이 털리더라도 몇천만원이 털리지는 않게 피해를 줄일 수 있다.</p>\n<h2 id=\"루트-사용자에-mfa-활성화\" style=\"position:relative;\"><a href=\"#%EB%A3%A8%ED%8A%B8-%EC%82%AC%EC%9A%A9%EC%9E%90%EC%97%90-mfa-%ED%99%9C%EC%84%B1%ED%99%94\" aria-label=\"루트 사용자에 mfa 활성화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루트 사용자에 MFA 활성화</h2>\n<p>보안 자격 증명 서비스에 들어갔을 때 루트 사용자에 MFA 할당을 안했다면 알아서 하라고 경고가 뜬다.<br>\n매우 친절하다. AWS에서도 내 계정이 털리지 않길 바라나 보다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzElEQVQY05WPy2qFQBBE/f9/jEbj6LxfanAkci4zkkAWWWRx6KKapro6EyLaWFap8CEQU/oh5Uzetn/RSaV4H8fGW9/TDwPjNDEMA4sy+JgIKeNjJqREiPFP6gOdNoZJLMzS8iEt87IihGAWglVKlPUon5AuYqxDG029qSj9W9dW3e4dWUmMDyht0PpZ1rRSSuMqhfM8H31dj39d3PfN130/dfPGfhx0ewxkq3EhYJ3DeY9zvulaI8ZESrl53zqE2GYNOUvhOD4b277zAiGoe4YLiWfyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"보안 자격 증명 탭의 MFA 활성화 경고\"\n        title=\"보안 자격 증명 탭의 MFA 활성화 경고\"\n        src=\"/static/065d8f8f0ccf23186a3f1ed997d23e0d/37523/mfa-alert.png\"\n        srcset=\"/static/065d8f8f0ccf23186a3f1ed997d23e0d/e9ff0/mfa-alert.png 180w,\n/static/065d8f8f0ccf23186a3f1ed997d23e0d/f21e7/mfa-alert.png 360w,\n/static/065d8f8f0ccf23186a3f1ed997d23e0d/37523/mfa-alert.png 720w,\n/static/065d8f8f0ccf23186a3f1ed997d23e0d/302a4/mfa-alert.png 1080w,\n/static/065d8f8f0ccf23186a3f1ed997d23e0d/dcccd/mfa-alert.png 1127w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>옆에 있는 MFA 할당 버튼을 누르거나 멀티 팩터 인증(MFA)를 직접 찾아서 활성화할 수도 있다.</p>\n<p>방법은 매우 간단하다.<br>\n모바일 디바이스 또는 컴퓨터 또는 기타 하드웨어 어쩌구를 이용해 인증하도록 설정해주면 된다.<br>\n사용하기 쉽게 폰에 Authenticator 앱을 설치하고 QR코드를 통해 연결해준다.<br>\n인증을 위해 MFA 숫자 두개를 입력하도록 하는데 앱의 MFA 숫자는 정해진 게 아니라 일정시간이 지나면 바뀌므로 바뀐 숫자를 추가로 입력해주면 된다.<br>\n그러면 MFA 활성화 완료~</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvElEQVQY041RXQ+DIAzk//+87c3noZUI+IUIiLeURGPMEnfJhQttj7aInDOMMbDWYhiGovmOse974ROuOYKLG2qgVAutNaZpOhMOwzvvMQb7xBgh8p5hrClmtu/xD64dHdo5h67rIOa04KUquHEGEUFKCaUUFu+RUkKKqbzMms/7Ou5rES55vKmC1RYfKVHXDYgaUEtoW8LsHNZ1hfe+cNs28FRs/Isi5Q3Wj4ghnkV+WU6TEELp7ODTJ30BWiXVxTPdlrEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MFA 활성화 완료 화면\"\n        title=\"MFA 활성화 완료 화면\"\n        src=\"/static/1548f2e9db5d3552919c296f5a080ab5/37523/mfa-success.png\"\n        srcset=\"/static/1548f2e9db5d3552919c296f5a080ab5/e9ff0/mfa-success.png 180w,\n/static/1548f2e9db5d3552919c296f5a080ab5/f21e7/mfa-success.png 360w,\n/static/1548f2e9db5d3552919c296f5a080ab5/37523/mfa-success.png 720w,\n/static/1548f2e9db5d3552919c296f5a080ab5/f73a1/mfa-success.png 822w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"iam-사용자-설정\" style=\"position:relative;\"><a href=\"#iam-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%84%A4%EC%A0%95\" aria-label=\"iam 사용자 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IAM 사용자 설정</h2>\n<p>IAM 서비스에서 사용자를 추가한다.<br>\n이름은 적당히 정하면 되고 권한 설정이 중요하다.<br>\n여기서 머리가 좀 어지럽다. 권한이 너무 많아!<br>\n그렇다고 Full Access 또는 관리자 수준의 권한을 주면 사용자를 만든 의미가 없어진다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABeklEQVQoz41SC27rIBD0/U/Qe7wL9Aa9wWtUJf5gzC5gAzbYUy1NoqZ9kR7SCBavh2GGZgkRpRTIOI7jv/F7HEKApu97GGL4eUGMsSLnfMe2bQ+Qw1NKYLawbPDeTnh57fDnTdeDGssM6xxYZmvB1sI5B+99nZdlqQSCEMJXDzOICGQM9GTw96JxuijkXNB0XYfT6R1910GpAcMg6CHKBVIrpSpkLf3n8xlt216/DdCqR99dsK4rGvGQ1AfGiTBMHsPkoCaPZYlV1c2GG9aUqnI96lrXnqt6sagp+4HILdjO0HbFyBFu2Z6GJKN6SIx93++RyLpeecs7ArUw7KAoYuQA8glpzTiOvTZ+h5CKMjJUA7rtl2uITS47Incg9tA2YbKxIqRcf/4nYU2ZHwlLQRGFQhjoArIek03QHJG2Ut/VT7IHhUTYr4SyJ4R3hUJoyGHkBG0jeF4xh+2r+emVTSW5eftAGJ0CuxnGrXf/tlyeKpRQ5D3+9FDqT1FvVcavqfL3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"IAM 정책들\"\n        title=\"IAM 정책들\"\n        src=\"/static/80f3923408eb3249e818aaec2716b473/37523/iam-policies.png\"\n        srcset=\"/static/80f3923408eb3249e818aaec2716b473/e9ff0/iam-policies.png 180w,\n/static/80f3923408eb3249e818aaec2716b473/f21e7/iam-policies.png 360w,\n/static/80f3923408eb3249e818aaec2716b473/37523/iam-policies.png 720w,\n/static/80f3923408eb3249e818aaec2716b473/302a4/iam-policies.png 1080w,\n/static/80f3923408eb3249e818aaec2716b473/78797/iam-policies.png 1125w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>무려 1065개의 정책들…</p>\n<p>나는 AWS 프리티어 계정에 인스턴스를 딱 하나만 만들고 접속해서 사용하는 것이 목표다.<br>\n따라서 EC2 인스턴스 정보를 읽는 것과 해당 인스턴스에 연결하는 것만 가능하고 나머지는 다 제어하는 권한을 부여해야 한다.<br>\n직접 권한을 부여하는 방법도 있지만 난 이미 존재하는 정책을 적용해 사용자 그룹을 만들었다.</p>\n<ol>\n<li>AmazonEC2ReadOnlyAccess</li>\n<li>EC2InstanceConnect</li>\n</ol>\n<p>방금 만든 사용자 그룹에 해당하는 사용자를 생성한다.</p>\n<p>여기서 끝이 아니다.<br>\n콘솔로 접속할 수 있도록 콘솔 엑세스를 활성화해줘야 한다.<br>\n사용자의 보안 자격 증명 탭에서 콘솔 액세스를 활성화할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz5VSy24iMRD0l+8xlxw3UiLxHdySkAjBAWm1YhlIInFhERoEkwmZh992rbonMyFLLlgq2W633eWqFvOnF/z6PcXV1U8sl0vQCCHg3OGcQwgR4ubmGr1eD1JKPvDe84MxxrNQlBU/KrQ2XZVjZnRIMMbC2q+guCX8F/chQGTZK9brNVarFbbbLa83mw2kVKiqiqsT65Y5XSyrCkSE4yFwvD0XT8/PGA6HmEwmGI/HGI1GSJIEdS3xmucnelrrcDi8Q2l9oiMVF0VRdpT1UZLzvoszgw9dKSfP35h9w6pBx5AukE7GGEalLd6lgbEOSinWKsTIyS1itydDcIQIUZYl6rrmy+T0Pj8gzXJ2rZaSi1B194Fm7ZrZaRiVQqsNjNoyU7Hb7b7Vo9Xk2FnXOWtgbYBWKQ7pBfZ/f+AtvYT3EmI6/YN+v4+Hx0cMBgPc3t7xfHd/jyzL+GFius8yZvvZe4G/2RXntosQ1Cqz2Qzz+ZxBri8WC8ySBEVRcCKxIkna73+FZTjfmPcPs+xOyZVhZaEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"보안 자격 증명 탭의 콘솔 액세스 활성화 버튼\"\n        title=\"보안 자격 증명 탭의 콘솔 액세스 활성화 버튼\"\n        src=\"/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/37523/iam-console-access.png\"\n        srcset=\"/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/e9ff0/iam-console-access.png 180w,\n/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/f21e7/iam-console-access.png 360w,\n/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/37523/iam-console-access.png 720w,\n/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/302a4/iam-console-access.png 1080w,\n/static/62ba710ceb9b3ea33e2f6d15bd3a1d84/ea64c/iam-console-access.png 1116w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이제 계정ID를 기억해두거나 콘솔 로그인 링크로 접속해 이 사용자로 콘솔 접속이 가능하다!<br>\n계정 ID나 콘솔 로그인 링크, 사용자 이름, 사용자 암호를 꼭 기억해두자.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%A3%A8%ED%8A%B8-%EC%82%AC%EC%9A%A9%EC%9E%90%EC%97%90-mfa-%ED%99%9C%EC%84%B1%ED%99%94\">루트 사용자에 MFA 활성화</a></li>\n<li><a href=\"#iam-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%84%A4%EC%A0%95\">IAM 사용자 설정</a></li>\n</ul>\n</div>","frontmatter":{"date":"April 10, 2023","title":"AWS 보안 향상하기 - MFA, IAM","categories":"aws"},"fields":{"slug":"/aws-mfa-iam/"}},"prev":{"id":"2a24772e-f40a-5730-a4b3-b2bbdeba2949","html":"<p>프론트엔드 개발을 위해 백엔드 REST API 서버를 만들었는데 다음과 같은 에러가 발생했다.</p>\n<blockquote>\n<p>❌ <strong>Mixed Content</strong>: The page at ’<a href=\"https://ordinary-todolist.netlify.app/login\">https://ordinary-todolist.netlify.app/login</a>’ was loaded over HTTPS, but requested an insecure XMLHttpRequest endpoint ’<a href=\"http://43.201.130.34:8000/auth/signin\">http://43.201.130.34:8000/auth/signin</a>’. This request has been blocked; the content must be served over HTTPS.</p>\n</blockquote>\n<p>내용을 해석해보니 요청을 HTTPS로 보내라는 것이다.<br>\n하지만 내 REST API 서버는 HTTPS 통신 설정도 안한 작고 소중한 아이였다..<br>\n어쩔수 없지. 까짓거 한다.</p>\n<h2 id=\"도메인-구매\" style=\"position:relative;\"><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B5%AC%EB%A7%A4\" aria-label=\"도메인 구매 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>도메인 구매</h2>\n<p>HTTPS 통신을 설정하기 위해서는 SSL 인증서가 필요하고, SSL 인증을 받기 위해서는 도메인이 필요하다.<br>\n도메인을 구매할 수 있는 경로는 다양하다.<br>\n나는 가비아를 통해서 구매했고 레코드 설정도 해줬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABJ0AAASdAHeZh94AAABHUlEQVQoz5WQy04DMQxF54tgARv28JcFxAY+h21boQohpL5m+sh0OrHj5KCktFTdEcnKPfa1E7l6eFtw/7rg7mXO1WDK9ePsLzIPzvlC/3Luu32ecfM0o5qslclKGTfCqFFGtTBceoZLYXzkWsp91Jc8qrV437/WVEF6tvueFA2THmIAEhDxXQuW2cCUFITg96jfF23qIVnJZb90jkpU6dXwqogGNBirzbZE74VgEYuxaC9a6hoCbdedctm798LWtVRmVn4kIsQYSSmxrBtm88WJc+R6CKHonN/tdiWXP7TZOnrvaduW6nsjfCx7mi5ANqdEfiQ3nw/M+sjZE80wi0yd8LnyTN1hcCWW6DUSYt7bYXv/OWqJPCNEcM7xA6t/CWcUcEL0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"가비아 DNS 레코드 수정 화면\"\n        title=\"가비아 DNS 레코드 수정 화면\"\n        src=\"/static/476eff56ca606d53de0a268518679e46/37523/gabia-dns-record.png\"\n        srcset=\"/static/476eff56ca606d53de0a268518679e46/e9ff0/gabia-dns-record.png 180w,\n/static/476eff56ca606d53de0a268518679e46/f21e7/gabia-dns-record.png 360w,\n/static/476eff56ca606d53de0a268518679e46/37523/gabia-dns-record.png 720w,\n/static/476eff56ca606d53de0a268518679e46/302a4/gabia-dns-record.png 1080w,\n/static/476eff56ca606d53de0a268518679e46/b94e3/gabia-dns-record.png 1126w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>도메인을 구매한 후 등록할 때 시간이 조금 걸리므로 여유를 가지고 확인하는 게 좋다.</p>\n<h2 id=\"ssl-인증\" style=\"position:relative;\"><a href=\"#ssl-%EC%9D%B8%EC%A6%9D\" aria-label=\"ssl 인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSL 인증</h2>\n<p>SSL 인증서를 발급해주는 곳은 다양한데 무료로 유명한 곳인 Let’s Encrypt를 이용했다.<br>\nLet’s Encrypt는 인증서를 발급해주는 곳이고 내 서버에서 이 인증서를 발급받기 위해서 certbot이라는 패키지를 이용했다.<br>\n발급받기 위한 다른 방법들도 있지만 certbot이 가장 대중적인 방법인 듯 하다. Let’s Encrypt 공식 홈페이지에서도 certbot을 사용하길 권장하고 있다.</p>\n<p>먼저, certbot을 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> certbot</code></pre></div>\n<p>그리고 인증서를 발급받기 전에 nginx를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> nginx</code></pre></div>\n<p>드디어 인증서 발급</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> certbot certonly <span class=\"token parameter variable\">--nginx</span></code></pre></div>\n<p>위 명령어를 치면 이메일을 입력하라거나 동의하라거나 도메인 주소를 입력하라거나 여러가지를 시키는데 알아서 잘 입력해주면 된다.<br>\n그러면 인증서는 <code class=\"language-text\">/etc/letsencrypt/live/도메인주소/fullchain.pem</code>에, 키는 <code class=\"language-text\">/etc/letsencrypt/live/도메인주소/privkey.pem</code>에 저장된다.</p>\n<p>이제 이 인증서와 키를 nginx에게 알려줘야 한다.</p>\n<h2 id=\"nginx-설정\" style=\"position:relative;\"><a href=\"#nginx-%EC%84%A4%EC%A0%95\" aria-label=\"nginx 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NginX 설정</h2>\n<p>아래 명령어를 통해 nginx 설정 파일을 편집한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">vi</span> /etc/nginx/sites-available/default</code></pre></div>\n<p>설정 파일을 편집하기에 앞서 나의 목표는 다음과 같다.<br>\n클라이언트에서 해당 인스턴스로 HTTPS로 요청하면 nginx의 reverse proxy 기능을 이용해 8000번 포트에서 돌아가고 있는 API 서버로 요청을 보내주는 것이다.</p>\n<p>아래와 같이 써줬다.<br>\n편집하고 나서 <code class=\"language-text\">:q!</code>는 저장안하고 강제로 나가기, <code class=\"language-text\">:wq</code>는 저장 후 나가기. 잊지 말자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">server <span class=\"token punctuation\">{</span>\n\t\tlisten <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n\t\tserver_name default_server<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token builtin class-name\">return</span> <span class=\"token number\">301</span> https://<span class=\"token variable\">$host</span><span class=\"token variable\">$request_uri</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nserver <span class=\"token punctuation\">{</span>\n\t\tlisten <span class=\"token number\">443</span> ssl<span class=\"token punctuation\">;</span>\n\t\tserver_name default_server<span class=\"token punctuation\">;</span>\n\n\t\tssl_certificate /etc/letsencrypt/live/도메인주소/fullchain.pem<span class=\"token punctuation\">;</span>\n\t\tssl_certificate_key /etc/letsencrypt/live/도메인주소/privkey.pem<span class=\"token punctuation\">;</span>\n\n\t\tlocation / <span class=\"token punctuation\">{</span>\n\t\t\t\tproxy_pass http://localhost:8000<span class=\"token punctuation\">;</span>\n\t\t\t\tproxy_http_version <span class=\"token number\">1.1</span><span class=\"token punctuation\">;</span>\n\t\t\t\tproxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n\t\t\t\tproxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>HTTP 통신으로 요청오면 자동으로 HTTPS 통신으로 넘어가도록 했다. (그냥. 어차피 HTTPS로 해야 에러 안나니까)<br>\nHTTPS 통신으로 요청이 오면 SSL 인증할 수 있도록 인증서랑 키의 위치를 입력해주고 8000번 포트로 연결해줬다.<br>\n<code class=\"language-text\">proxy_pass</code> 아래는 그냥 프록시 관련 설정들이다.</p>\n<p>nginx 설정을 해줬으면 nginx를 시작해주거나, 이미 켜져있다면 재시작해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx restart</code></pre></div>\n<p>재시작 명령어만 써놓은 이유는 시작했는지 고민할 시간에 수시로 재시작하는 게 더 편해서 ㅎㅎ</p>\n<p>시작하기 전에 nginx 테스트를 해봐도 좋다.<br>\n설정 파일에 문제가 없는지 테스트해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> nginx <span class=\"token parameter variable\">-t</span></code></pre></div>\n<p>nginx를 시작하고 나서 제대로 돌아가는지 확인할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl status nginx</code></pre></div>\n<p>구매했던 도메인 주소로 잘 들어가지면 성공!</p>\n<p>사실 nginx 설정은 이전에도 몇 번 해봤었는데 어떤 용도로 사용하느냐에 따라 설정을 달리 해주다 보니 할때마다 헤맨다..<br>\n그래도 점점 알아가는 것 같아서 좋다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B5%AC%EB%A7%A4\">도메인 구매</a></li>\n<li><a href=\"#ssl-%EC%9D%B8%EC%A6%9D\">SSL 인증</a></li>\n<li><a href=\"#nginx-%EC%84%A4%EC%A0%95\">NginX 설정</a></li>\n</ul>\n</div>","frontmatter":{"date":"May 24, 2023","title":"REST API 서버에 HTTPS 통신 설정하기","categories":"web"},"fields":{"slug":"/rest-api-https/"}},"site":{"siteMetadata":{"siteUrl":"https://heony704.github.io","comments":{"utterances":{"repo":"heony704/heony704.github.io"}}}}},"pageContext":{"slug":"/react-rendering-optimization/","nextSlug":"/aws-mfa-iam/","prevSlug":"/rest-api-https/"}},"staticQueryHashes":["161131432","1956554647","2938748437"]}